Add-Type -AssemblyName System.Speech
Add-Type -AssemblyName Microsoft.VisualBasic
Add-Type -Name Win -Namespace H -MemberDefinition '
  [DllImport("kernel32.dll")]public static extern IntPtr GetConsoleWindow();
  [DllImport("user32.dll")]public static extern bool ShowWindow(IntPtr hWnd, int nCmdShow);'
[H.Win]::ShowWindow([H.Win]::GetConsoleWindow(), 0)

# ========== –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –ø—É—Ç–∏ ==========
$temp = "$env:TEMP\prnkcam"
$zip = "$temp\ffmpeg.zip"
$ffmpegExe = "$temp\ffmpeg.exe"
$image = "$temp\captured.jpg"
$desktop = [Environment]::GetFolderPath("Desktop")
$no = "$desktop\no.txt"

New-Item -Path $temp -ItemType Directory -Force | Out-Null

# ========== –°–ö–ê–ß–ò–í–ê–ù–ò–ï FFMPEG ==========
if (!(Test-Path $ffmpegExe)) {
    $url = "https://www.gyan.dev/ffmpeg/builds/ffmpeg-release-essentials.zip"
    Invoke-WebRequest $url -OutFile $zip -UseBasicParsing
    Expand-Archive -Force -Path $zip -DestinationPath $temp
    $found = Get-ChildItem $temp -Recurse -Filter "ffmpeg.exe" | Where-Object { $_.FullName -like "*\bin\ffmpeg.exe" } | Select-Object -First 1
    if ($found) {
        Move-Item $found.FullName $ffmpegExe -Force
        Remove-Item $zip -Force
    } else {
        Set-Content -Path $no -Value "‚ùå ffmpeg.exe –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –∞—Ä—Ö–∏–≤–µ." -Force
        exit
    }
}

# ========== –û–ü–†–ï–î–ï–õ–ï–ù–ò–ï –ò–ú–ï–ù–ò –ö–ê–ú–ï–†–´ ==========
$camRaw = & $ffmpegExe -f dshow -list_devices true -i dummy 2>&1
$camName = ($camRaw | Where-Object {$_ -match '"(.*?)"'}) | ForEach-Object {
    if ($_ -match '"(.*?)"') { $Matches[1] }
} | Where-Object { $_ -notmatch "audio" } | Select-Object -First 1

if (!$camName) {
    Set-Content -Path $no -Value "‚ùó –ö–∞–º–µ—Ä–∞ –ù–ï –Ω–∞–π–¥–µ–Ω–∞ —á–µ—Ä–µ–∑ ffmpeg :(" -Force
    exit
}

# ========== –î–ï–õ–ê–ï–ú –§–û–¢–û –° –ö–ê–ú–ï–†–´ ==========
try {
    & $ffmpegExe -f dshow -i "video=$camName" -vframes 1 "$image" -y -loglevel quiet
}
catch {
    Set-Content -Path $no -Value "üíÄ –û—à–∏–±–∫–∞ ffmpeg –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —Ñ–æ—Ç–æ: $_" -Force
    exit
}

if (!(Test-Path $image)) {
    Set-Content -Path $no -Value "üìõ –°–Ω–∏–º–æ–∫ –Ω–µ –±—ã–ª —Å–æ–∑–¥–∞–Ω. –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω." -Force
    exit
}

# ========== –£–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–ú –û–ë–û–ò ==========
Add-Type @"
using System.Runtime.InteropServices;
public class Wallpaper {
    [DllImport("user32.dll", SetLastError=true)]
    public static extern bool SystemParametersInfo(int uAction, int uParam, string lpvParam, int fuWinIni);
}
"@
[Wallpaper]::SystemParametersInfo(20, 0, $image, 3)

# ========== –û–ó–í–£–ß–ò–í–ê–ù–ò–ï (TTS) ==========
$tts = New-Object System.Speech.Synthesis.SpeechSynthesizer
$tts.Rate = -1
$tts.Speak("Smile. Your camera just took a photo.")
Start-Sleep -Milliseconds 500
$tts.Speak("It has been set as your desktop wallpaper.")

# ========== –§–ò–ù–ê–õ–¨–ù–û–ï –°–û–û–ë–©–ï–ù–ò–ï ==========
[Microsoft.VisualBasic.Interaction]::MsgBox("‚úÖ –ü—Ä–∞–Ω–∫–∞–Ω—É—Ç–æ! –ó–∞–≥–ª—è–Ω–∏ –Ω–∞ —Ä–∞–±–æ—á–∏–π —Å—Ç–æ–ª üòà", "OkOnly", "Complete")
