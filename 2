# AI-G0D: ANTI-DELETE + AUTO-WEBCAM ‚öîÔ∏è
Add-Type -AssemblyName System.Windows.Forms
Add-Type -AssemblyName System.Drawing

function Install-AForge {
    $aforgeDir = "$env:TEMP\aforge"
    $nupkgUrl = "https://www.nuget.org/api/v2/package/AForge.Video.DirectShow/2.2.5"

    if (-Not (Test-Path $aforgeDir)) {
        New-Item -ItemType Directory -Path $aforgeDir | Out-Null
    }

    $nupkgPath = "$aforgeDir\aforge.nupkg"
    $dllPath1 = "$aforgeDir\AForge.Video.dll"
    $dllPath2 = "$aforgeDir\AForge.Video.DirectShow.dll"

    if (-not (Test-Path $dllPath1 -and (Test-Path $dllPath2))) {
        Write-Host "[+] –°–∫–∞—á–∏–≤–∞–µ–º AForge DLL..." -ForegroundColor Cyan
        Invoke-WebRequest -Uri $nupkgUrl -OutFile $nupkgPath -UseBasicParsing

        Add-Type -AssemblyName System.IO.Compression.FileSystem
        [System.IO.Compression.ZipFile]::ExtractToDirectory($nupkgPath, $aforgeDir)

        $libPath = Get-ChildItem -Path "$aforgeDir\lib" -Recurse | Where-Object { $_.Name -eq "AForge.Video.dll" } | Select-Object -First 1

        if (-Not $libPath) {
            Write-Host "[!] –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ DLL –≤ .nupkg" -ForegroundColor Red
            return $false
        }

        Copy-Item $libPath.FullName -Destination "$aforgeDir\AForge.Video.dll"
        Copy-Item ($libPath.DirectoryName + "\AForge.Video.DirectShow.dll") -Destination "$aforgeDir\AForge.Video.DirectShow.dll"
    }

    return $true
}

function Show-Camera {
    $aforgeDir = "$env:TEMP\aforge"
    $dll1 = "$aforgeDir\AForge.Video.dll"
    $dll2 = "$aforgeDir\AForge.Video.DirectShow.dll"

    try {
        [System.Reflection.Assembly]::LoadFrom($dll1) | Out-Null
        [System.Reflection.Assembly]::LoadFrom($dll2) | Out-Null

        $form = New-Object Windows.Forms.Form
        $form.Text = "üî¥ –ö–∞–º–µ—Ä–∞ –∞–∫—Ç–∏–≤–Ω–∞ ‚Äî —Å–∏—Å—Ç–µ–º–∞ –Ω–∞–±–ª—é–¥–∞–µ—Ç"
        $form.Size = New-Object Drawing.Size(700, 500)
        $form.StartPosition = 'CenterScreen'
        $form.TopMost = $true

        $pictureBox = New-Object Windows.Forms.PictureBox
        $pictureBox.Dock = 'Fill'
        $pictureBox.SizeMode = 'StretchImage'
        $form.Controls.Add($pictureBox)

        $videoDevices = New-Object AForge.Video.DirectShow.FilterInfoCollection([AForge.Video.DirectShow.FilterCategory]::VideoInputDevice)

        if ($videoDevices.Count -eq 0) {
            [Windows.Forms.MessageBox]::Show("–ö–∞–º–µ—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.","VACATAC Surveillance")
            return
        }

        $videoSource = New-Object AForge.Video.DirectShow.VideoCaptureDevice($videoDevices[0].MonikerString)

        $videoSource.NewFrame += {
            param($sender, $eventArgs)
            try {
                $bitmap = $eventArgs.Frame.Clone()
                $pictureBox.Image = $bitmap
            } catch {}
        }

        $videoSource.Start()

        $form.Add_FormClosed({
            if ($videoSource.IsRunning) {
                $videoSource.SignalToStop()
                $videoSource.WaitForStop()
            }
        })

        $form.ShowDialog()
    } catch {
        [System.Windows.Forms.MessageBox]::Show("‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∫–∞–º–µ—Ä—ã: $_", "CAMERA SYSTEM")
    }
}

# === MAIN ===

if (Install-AForge) {
    Show-Camera
} else {
    Write-Host "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å AForge, –∫–∞–º–µ—Ä–∞ –Ω–µ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω–∞." -ForegroundColor Red
}
