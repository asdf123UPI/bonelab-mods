Add-Type -AssemblyName System.Speech
Add-Type -AssemblyName Microsoft.VisualBasic
Add-Type -Name Win -Namespace H -MemberDefinition '
  [DllImport("kernel32.dll")]public static extern IntPtr GetConsoleWindow();
  [DllImport("user32.dll")]public static extern bool ShowWindow(IntPtr hWnd, int nCmdShow);'
[H.Win]::ShowWindow([H.Win]::GetConsoleWindow(), 0)

# === –ü–£–¢–ò ===
$temp = "$env:TEMP\prnkcam"
$ffmpegZip = "$temp\ffmpeg.zip"
$ffmpegExe = "$temp\ffmpeg.exe"
$image = "$temp\shot.jpg"
$desktop = [Environment]::GetFolderPath("Desktop")
$noFile = "$desktop\no.txt"

New-Item -Path $temp -ItemType Directory -Force | Out-Null

# === –°–ö–ê–ß–ò–í–ê–ï–ú ffmpeg –∏ —Ä–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ–º ===
if (!(Test-Path $ffmpegExe)) {
    Write-Host "üì¶ Downloading ffmpeg..."
    $url = "https://github.com/ffbinaries/ffbinaries-prebuilt/releases/download/v4.4.1/ffmpeg-win64.zip"
    Invoke-WebRequest $url -OutFile $ffmpegZip -UseBasicParsing

    Expand-Archive -Force -Path $ffmpegZip -DestinationPath $temp

    $found = Get-ChildItem -Path $temp -Recurse -Include "ffmpeg.exe" | Select-Object -First 1
    if ($found) {
        Move-Item $found.FullName $ffmpegExe -Force
        Remove-Item $ffmpegZip -Force
    } else {
        Set-Content -Path $noFile -Value "‚ùå ffmpeg not found after extraction." -Force
        exit
    }
}

# === –ù–ê–•–û–î–ò–ú –ò–ú–Ø –ö–ê–ú–ï–†–´ ===
Write-Host "üé• Detecting camera..."
$camRaw = & $ffmpegExe -f dshow -list_devices true -i dummy 2>&1
$camName = ($camRaw | Where-Object {$_ -match '"(.*?)"'}) | ForEach-Object {
    if ($_ -match '"(.*?)"') { $Matches[1] }
} | Where-Object {$_ -notmatch "audio"} | Select-Object -First 1

if (!$camName) {
    Set-Content -Path $noFile -Value "‚ùó –ö–∞–º–µ—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ ffmpeg'–æ–º." -Force
    exit
}

# === –î–ï–õ–ê–ï–ú –°–ù–ò–ú–û–ö ===
Write-Host "üì∏ Taking photo from: $camName..."
try {
    & $ffmpegExe -f dshow -i "video=$camName" -vframes 1 "$image" -y -loglevel quiet
}
catch {
    Set-Content -Path $noFile -Value "üí• –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å—ä—ë–º–∫–µ —Å –∫–∞–º–µ—Ä—ã: $camName" -Force
    exit
}
if (!(Test-Path $image)) {
    Set-Content -Path $noFile -Value "‚ùå –°–Ω–∏–º–æ–∫ –Ω–µ –±—ã–ª —Å–æ—Ö—Ä–∞–Ω—ë–Ω. –ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫." -Force
    exit
}

# === –°–¢–ê–í–ò–ú –û–ë–û–ò ===
Add-Type @"
using System.Runtime.InteropServices;
public class Wallpaper {
    [DllImport("user32.dll", SetLastError=true)]
    public static extern bool SystemParametersInfo(int uAction, int uParam, string lpvParam, int fuWinIni);
}
"@
[Wallpaper]::SystemParametersInfo(20, 0, $image, 3)

# === TTS –í–ö–õ–Æ–ß–ê–ï–ú ===
$speak = New-Object System.Speech.Synthesis.SpeechSynthesizer
$speak.Rate = -1
$speak.Speak("Smile. Your camera just took a picture.")
Start-Sleep -Milliseconds 800
$speak.Speak("It has replaced your desktop forever.")

# === –§–ò–ù–ê–õ–¨–ù–û–ï –°–û–û–ë–©–ï–ù–ò–ï ===
[Microsoft.VisualBasic.Interaction]::MsgBox("‚úÖ –ü—Ä–∞–Ω–∫ —É–¥–∞–ª—Å—è! –ü–æ—Å–º–æ—Ç—Ä–∏ –Ω–∞ —Ä–∞–±–æ—á–∏–π —Å—Ç–æ–ª... üòà", "OkOnly", "PRANK COMPLETE")
